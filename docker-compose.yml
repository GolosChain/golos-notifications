version: "3"
#
services:
#
  datastore:
    restart: always
    image: golosio/push-datastore:0.0.2
    build:
      context: ./packages/push.golos.io/datastore
      dockerfile: Dockerfile
#      args:
#    command: tarantool /usr/local/etc/tarantool/instances.enabled/app.lua
    # environment:
    #      TARANTOOL_USER_NAME:
    #      TARANTOOL_USER_PASSWORD:
    #      TARANTOOL_PORT:
    #      TARANTOOL_REPLICATION_SOURCE:
    #      TARANTOOL_SLAB_ALLOC_ARENA:
    #      TARANTOOL_SLAB_ALLOC_FACTOR:
    #      TARANTOOL_SLAB_ALLOC_MAXIMAL:
    #      TARANTOOL_SLAB_ALLOC_MINIMAL:
    #      TARANTOOL_SNAPSHOT_PERIOD:
    ports:
      - 3301:3301
#    volumes:
#      - [apps]:/usr/local/etc/tarantool/instances.enabled
#      - [apps]:/opt/tarantool/app.lua
#      - [data]:/var/lib/tarantool
#      - [log]:/var/log/tarantool
    networks:
      - prod
  push:
#    depends_on:
#      - datastore
    stdin_open: true
    tty: true
    restart: always
    image: golosio/push-service:0.0.2
    environment:
      - DEBUG=node-gcm
      - API_STATSD_URL=someurl
      - API_GCM_KEY=AAAA...
      - API_GOLOS_URL=wss://ws.golos.io
      - API_QUEUE_HOST=datastore
#    env_file:
#      - ./packages/push.golos.io/.env
    build:
      context: ./packages
      dockerfile: ./push.golos.io/Dockerfile.local
    ports:
      - 8000:8000
    networks:
      - prod

networks:
  prod:
